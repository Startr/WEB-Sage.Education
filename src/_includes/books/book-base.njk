{# Import navigation macros #}
{% from "books/navigation.njk" import bookNavigation %}

<!doctype html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width">
  <meta charset="utf-8">
  
  <!-- Book Title and SEO -->
  <title>{{ title or book.title or site.title }}</title>
  
  <meta name="description" content="{{ description or book.description or site.description }}">
  <meta name="theme-color" content="{{ book.themeColor or '#ffffff' }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- OpenGraph Metadata -->
  <meta property="og:title" content="{{ ogTitle or title or book.title }}">
  <meta property="og:description" content="{{ ogDescription or description or book.description }}">
  <meta property="og:image" content="{{ ogImage or book.ogImage or ('/assets/images/opengraph/' + book.slug + '.png') }}">
  <meta property="og:url" content="{{ canonical or page.url | url }}">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="{{ site.title }}">
  
  <!-- Twitter Card Metadata -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ twitterTitle or ogTitle or title or book.title }}">
  <meta name="twitter:description" content="{{ twitterDescription or ogDescription or description or book.description }}">
  <meta name="twitter:image" content="{{ twitterImage or ogImage or book.ogImage or ('/assets/images/opengraph/' + book.slug + '.png') }}">
  <meta name="twitter:creator" content="{{ book.twitterCreator or '@sage' }}">
  <meta name="twitter:site" content="{{ book.twitterSite or '@sage' }}">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="{{ canonical or page.url | url }}">
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/general/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/general/favicon-16.png">
  <link rel="apple-touch-icon" href="/assets/images/general/apple-touch-icon.png">
  
  <!-- Book Styles -->
  <link rel="stylesheet" href="/assets/css/web-book.css" type="text/css">
  <link rel="stylesheet" href="https://use.typekit.net/xig7qap.css">
  <link rel="stylesheet" href="https://startr.style/style.css">
  
  <!-- Book Scripts -->
  <script src="/assets/js/packages/popper.js"></script>
  <script src="/assets/js/web-book.js" type="module"></script>
  
  <!-- Analytics -->
  <script async data-domain="sage.is" src="/assets/js/script.outbound-links.tagged-events.js"></script>
</head>

<body 
  style="
    --minh:100vh;
    --bg:url('data:image/svg+xml;charset=utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20512%20512%22%20width%3D%22512%22%20height%3D%22512%22%20preserveAspectRatio%3D%22none%22%3E%20%3Cstyle%20type%3D%22text%2Fcss%22%3E%20path%20%7B%20fill%3A%20none%3B%20stroke%3A%20rgba(235,201,143,0.451)%3B%20stroke-width%3A%201.01px%3B%20%7D%20%3C%2Fstyle%3E%20%3Cpath%20vector-effect%3D%22non-scaling-stroke%22%20d%3D%22M111.2%2C81.7L-33.7%2C226.6c-13.9%2C13.9-36.5%2C13.9-50.5%2C0L-229.1%2C81.7%20c-22.5-22.5-6.6-60.9%2C25.2-60.9H86C117.7%2C20.7%2C133.7%2C59.2%2C111.2%2C81.7z%22%2F%3E%20%3Cpath%20vector-effect%3D%22non-scaling-stroke%22%20d%3D%22M366.8%2C338.3L221.9%2C483.2c-13.9%2C13.9-36.5%2C13.9-50.5%2C0L26.6%2C338.3%20c-22.5-22.5-6.6-60.9%2C25.2-60.9h289.8C373.4%2C277.4%2C389.3%2C315.8%2C366.8%2C338.3z%22%2F%3E%20%3Cpath%20vector-effect%3D%22non-scaling-stroke%22%20d%3D%22M40.6%2C423l-144.9-144.9c-13.9-13.9-13.9-36.5%2C0-50.5L40.6%2C82.8%20c22.5-22.5%2C60.9-6.6%2C60.9%2C25.2v289.8C101.5%2C429.6%2C63.1%2C445.5%2C40.6%2C423z%22%2F%3E%20%3Cpath%20vector-effect%3D%22non-scaling-stroke%22%20d%3D%22M296.3%2C679.7L151.4%2C534.8c-13.9-13.9-13.9-36.5%2C0-50.5l144.9-144.9%20c22.5-22.5%2C60.9-6.6%2C60.9%2C25.2v289.8C357.2%2C686.3%2C318.8%2C702.2%2C296.3%2C679.7z%22%2F%3E%20%3Cpath%20vector-effect%3D%22non-scaling-stroke%22%20d%3D%22M623.5%2C81.7L478.6%2C226.6c-13.9%2C13.9-36.5%2C13.9-50.5%2C0L283.2%2C81.7%20c-22.5-22.5-6.6-60.9%2C25.2-60.9h289.8C630%2C20.7%2C646%2C59.2%2C623.5%2C81.7z%22%2F%3E%20%3Cpath%20vector-effect%3D%22non-scaling-stroke%22%20d%3D%22M296.3%2C166.4L151.4%2C21.5c-13.9-13.9-13.9-36.5%2C0-50.5l144.9-144.9%20c22.5-22.5%2C60.9-6.6%2C60.9%2C25.2v289.8C357.2%2C173%2C318.8%2C188.9%2C296.3%2C166.4z%22%2F%3E%20%3Cpath%20vector-effect%3D%22non-scaling-stroke%22%20d%3D%22M552.9%2C423L408%2C278.2c-13.9-13.9-13.9-36.5%2C0-50.5L552.9%2C82.8%20c22.5-22.5%2C60.9-6.6%2C60.9%2C25.2v289.8C613.8%2C429.6%2C575.4%2C445.5%2C552.9%2C423z%22%2F%3E%3C%2Fsvg%3E');"
  data-controller="sidebar glossary" 
  data-action="keydown->sidebar#closeWithKey">

  <main id="main" class="wb">
    {% block content %}
    <!-- Chapter content goes here -->
    {% endblock %}
  </main>

  <!-- Book-specific navigation -->
  {% block navigation %}
  {% if book %}
    {% set grouped = collections.booksBySlug %}
    {% set bookChapters = grouped[book.slug] %}
    {% if bookChapters %}
      {{ bookNavigation(book, bookChapters, page) }}
    {% endif %}
  {% endif %}
  {% endblock %}

</body>
</html>